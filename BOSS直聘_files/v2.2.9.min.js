!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Warlock=t()}(this,(function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,r);if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==e(r)?r:r+""}function r(e,r,n){return(r=t(r))in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,r,n){return r&&function(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t(i.key),i)}}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(t){return"function"==typeof t||!(!t||"object"!==e(t))&&a(t.listener)}String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.slice(t,e.length)===e}),function(){function e(e){1===this.readyState&&(this.start_time=(new Date).getTime());var t=null;"function"==typeof CustomEvent?t=new CustomEvent(e,{detail:this}):((t=document.createEvent("HTMLEvents")).initEvent(e,!0,!0),t.detail=this),window.dispatchEvent(t)}var t=window.XMLHttpRequest;window.XMLHttpRequest=function(){var r=new t;return r.addEventListener("abort",(function(){e.call(this,"ajaxAbort")}),!1),r.addEventListener("error",(function(){e.call(this,"ajaxError")}),!1),r.addEventListener("load",(function(){e.call(this,"ajaxLoad")}),!1),r.addEventListener("loadstart",(function(){e.call(this,"ajaxLoadStart")}),!1),r.addEventListener("progress",(function(){e.call(this,"ajaxProgress")}),!1),r.addEventListener("timeout",(function(){e.call(this,"ajaxTimeout")}),!1),r.addEventListener("loadend",(function(){e.call(this,"ajaxLoadEnd")}),!1),r.addEventListener("readystatechange",(function(){e.call(this,"ajaxReadyStateChange")}),!1),r}}();var o,s=function(){return i((function e(){n(this,e),this._events={}}),[{key:"on",value:function(t,r){if(!t||!r)return!1;if(!a(r))throw new Error("listener must be a function");this._events[t]=this._events[t]||[];var n="object"===e(r);return this._events[t].push(n?r:{listener:r,once:!1}),this}},{key:"once",value:function(e,t){return this.on(e,{listener:t,once:!0})}},{key:"off",value:function(e,t){var r=this._events[e];if(!r)return!1;if("number"==typeof t)r.splice(t,1);else if("function"==typeof t)for(var n=0,i=r.length;n<i;n++)r[n]&&r[n].listener===t&&r.splice(n,1);return this}},{key:"emit",value:function(e,t){var r=this._events[e];if(!r)return!1;for(var n=0;n<r.length;n++){var i=r[n];i&&(i.listener.call(this,t||{}),i.once&&this.off(e,n))}return this}},{key:"prepend",value:function(t,r){if(!t||!r)return!1;if(!a(r))throw new Error("listener must be a function");this._events[t]=this._events[t]||[];var n="object"===e(r);return this._events[t].unshift(n?r:{listener:r,once:!1}),this}},{key:"prependOnce",value:function(e,t){return this.prepend(e,{listener:t,once:!0})}},{key:"removeAllListeners",value:function(e){e&&this._events[e]?this._events[e]=[]:this._events={}}},{key:"listeners",value:function(e){return e&&"string"==typeof e?this._events[e]:this._events}}])}(),c=new s;!function(e){e.LOG="log",e.INFO="info",e.WARN="warn",e.ERROR="error"}(o||(o={}));var u=new(function(){return i((function e(t){n(this,e),Object.defineProperty(this,"logLevel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"levels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.logLevel=t,this.levels=["log","info","warn","error"]}),[{key:"canLog",value:function(){return!!(ut.para.show_log||S.isSupport()&&"true"===sessionStorage.getItem("warlock_jssdk_debug"))}},{key:"printLog",value:function(e,t,r){var n=this.levels.indexOf(this.logLevel);if(this.levels.indexOf(t)>=n){var i=H(new Date),a=this.getMsgPrefix(r);D(e)?console[t]("[".concat(t.toUpperCase(),"] [").concat(i,"] ").concat(a),e):console[t]("[".concat(t.toUpperCase(),"] [").concat(i,"] ").concat(a," ").concat(e))}}},{key:"getMsgPrefix",value:function(e){return e?"".concat(e):""}},{key:"log",value:function(e,t){try{this.canLog()&&this.printLog(e,o.LOG,t)}catch(e){}}},{key:"info",value:function(e,t){try{this.canLog()&&this.printLog(e,o.INFO,t)}catch(e){}}},{key:"warn",value:function(e,t){try{this.canLog()&&this.printLog(e,o.WARN,t)}catch(e){}}},{key:"error",value:function(e,t){try{this.canLog()&&this.printLog(e,o.ERROR,t)}catch(e){}}}])}())(o.LOG),l=Array.prototype.forEach,f=Object.prototype.hasOwnProperty;function d(e,t,r){if(null==e)return!1;if(l&&e.forEach===l)e.forEach(t,r);else if(E(e))for(var n=0,i=e.length;n<i;n++)n in e&&t.call(r,e[n],n,e);else for(var a in e)f.call(e,a)&&t.call(r,e[a],a,e)}function p(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return d(r,(function(t){for(var r in t)f.call(t,r)&&void 0!==t[r]&&(e[r]=t[r])})),e}function h(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return d(r,(function(t){for(var r in t)void 0!==t[r]&&void 0===e[r]&&(e[r]=t[r])})),e}function g(e,t,r){if(e.filter)return e.filter(t);for(var n=[],i=0;i<e.length;i++)if(f.call(e,i)){var a=e[i];t.call(r,a,i,e)&&n.push(a)}return n}function v(e){var t=e;try{t=decodeURI(e)}catch(r){t=e}return t}function m(){var e,t={},r=navigator.userAgent.toLowerCase();return(e=r.match(/ qq\/([\d.]+)/))?t.qqBuildinBrowser=Number(e[1].split(".")[0]):(e=r.match(/mqqbrowser\/([\d.]+)/))?t.qqBrowser=Number(e[1].split(".")[0]):(e=r.match(/opera.([\d.]+)/))?t.opera=Number(e[1].split(".")[0]):(e=r.match(/msie ([\d.]+)/))?t.ie=Number(e[1].split(".")[0]):(e=r.match(/edge.([\d.]+)/))?t.edge=Number(e[1].split(".")[0]):(e=r.match(/firefox\/([\d.]+)/))?t.firefox=Number(e[1].split(".")[0]):(e=r.match(/chrome\/([\d.]+)/))?t.chrome=Number(e[1].split(".")[0]):(e=r.match(/version\/([\d.]+).*safari/))?t.safari=Number(e[1].match(/^\d*.\d*/)):(e=r.match(/trident\/([\d.]+)/))&&(t.ie=11),t}function _(e){return R(e)?v(e=J(e)):v(location.href)}function b(e){({visibleHandler:L(e.visible)?e.visible:function(){},hiddenHandler:L(e.hidden)?e.hidden:function(){},visibilityChange:null,hidden:null,isSupport:function(){return void 0!==document[this.hidden]},init:function(){void 0!==document.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==document.mozHidden?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):void 0!==document.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),this.listen()},listen:function(){if(this.isSupport()){var e=this;Ce(document,this.visibilityChange,(function(){document[e.hidden]?e.hiddenHandler():e.visibleHandler()}),!0)}else Ce(window,"focus",this.visibleHandler),Ce(window,"blur",this.hiddenHandler)}}).init()}function y(e,t){var r=document.createElement("Script");r.setAttribute("charset","UTF-8"),r.type="text/javascript",r.onload=r.onreadystatechange=function(){this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(t(),r.onload=r.onreadystatechange=null)},r.onerror=function(){console.log("warlocksdk load script error"),r.onerror=null},r.src=e,document.getElementsByTagName("head")[0].appendChild(r)}var w={get:function(e){for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var i=r[n];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return decodeURIComponent(i.substring(t.length,i.length))}return null},set:function(e,t,r,n,i){var a,o="",s="",c="";if(r=null!==(a=r)&&void 0!==a?a:73e3,n){var u=ie(location.href);"url解析失败"===u&&(u=""),o=u?"; domain="+u:""}if(0!==r){var l=new Date;"s"===String(r).slice(-1)?l.setTime(l.getTime()+1e3*Number(String(r).slice(0,-1))):l.setTime(l.getTime()+24*r*60*60*1e3),s="; expires="+l.toUTCString()}i&&(c="; SameSite=None; Secure"),document.cookie=e+"="+encodeURIComponent(t)+s+"; path=/"+o+c},remove:function(e,t){t=void 0===t?ut.para.cross_subdomain:t,w.set(e,"",-1,t)},getCookieName:function(e){return"wljssdk_cross_"+e},getNewUser:function(){return null!==this.get("warlock_is_new_user")||null!==this.get(this.getCookieName("new_user"))},isSupport:function(e,t){e=e||"cookie_support_test",t=t||"1";var r=this;return navigator.cookieEnabled&&(r.set(e,t),r.get(e)===t&&(r.remove(e),!0))}},k={get:function(e){return window.localStorage&&window.localStorage.getItem(e)},parse:function(e){var t;try{t=JSON.parse(k.get(e))||null}catch(e){u.log("parse localStorage failed")}return t},set:function(e,t){try{return window.localStorage.setItem(e,t),!0}catch(e){return u.log("localStorage is not support"),!1}},remove:function(e){window.localStorage.removeItem(e)},isSupport:function(){var e=!0;try{var t="__local_storage_support__",r="testIsSupportStorage";k.set(t,r),k.get(t)!==r&&(e=!1),k.remove(t)}catch(t){e=!1}return e}},S={isSupport:function(){var e=!0,t="__session_storage_support__";try{sessionStorage&&sessionStorage.setItem?(sessionStorage.setItem(t,"testIsSupportStorage"),sessionStorage.removeItem(t),e=!0):e=!1}catch(t){e=!1}return e}};function O(e){var t=e;try{t=decodeURIComponent(e)}catch(r){t=e}return t}function P(e,t){return e.hasAttribute?e.hasAttribute(t):e.attributes?!(!e.attributes[t]||!e.attributes[t].specified):void 0}function j(e,t){if("string"==typeof t)return P(e,t);if(E(t)){for(var r=!1,n=0;n<t.length;n++){if(P(e,t[n])){r=!0;break}}return r}}function T(e,t){var r=e.indexOf;if(r)return r.call(e,t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1}function N(e){for(var t={},r=(e=e||"").substring(1).split("&"),n=0;n<r.length;n++){var i=r[n].indexOf("=");if(-1!==i){var a=r[n].substring(0,i),o=r[n].substring(i+1);a=O(a),o=O(o),t[a]=o}}return t}function x(e){return!(!e||1!==e.nodeType)}function C(e){return void 0===e}function E(e){return Array.isArray&&L(E)?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function L(e){if(!e)return!1;var t=Object.prototype.toString.call(e);return"[object Function]"==t||"[object AsyncFunction]"==t}function D(e){return null!=e&&"[object Object]"==Object.prototype.toString.call(e)}function I(e){return"[object Number]"==Object.prototype.toString.call(e)&&/[\d\.]+/.test(String(e))}function R(e){return"[object String]"==Object.prototype.toString.call(e)}function A(e){if(R(e)){var t=J(e);return"undefined"!==t&&null!=t&&""!==t&&0!==t.length}return!1}function U(e){try{JSON.parse(e)}catch(e){return!1}return!0}function q(e){return"[object Date]"==Object.prototype.toString.call(e)}function H(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}function M(e){return"[object Boolean]"==Object.prototype.toString.call(e)}function V(e){if(D(e)){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}return!1}function F(t){if("object"===e(t)&&t.$option){var r=t.$option;return delete t.$option,r}return{}}function K(e){return D(e)?(d(e,(function(t,r){if(E(t)){var n=[];d(t,(function(e){R(e)?n.push(e):u.log('您的数据-",\n            '.concat(r,",\n            ").concat(t,',\n            "的数组里的值必须是字符串,已经将其删除'))})),0!==n.length?e[r]=n:(delete e[r],u.log("已经删除空的数组"))}R(t)||I(t)||q(t)||M(t)||E(t)||L(t)||"$option"===r||(u.log('您的数据-", '.concat(r,", ").concat(t,', "-格式不满足要求，我们已经将其删除')),delete e[r])})),e):e}function J(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}function X(){return Date.now&&L(Date.now)?Date.now():(new Date).getTime()}function z(){return void 0!==window.XMLHttpRequest&&("withCredentials"in new XMLHttpRequest||"undefined"!=typeof XDomainRequest)}function W(e){(D(e)||E(e))&&d(e,(function(t,r){D(t)||E(t)?W(e[r]):q(t)&&(e[r]=H(t))}))}function $(e){D(e)&&d(["distinct_id","events"],(function(t){t in e&&u.log("您的属性- "+t+"是保留字段，请避免其作为属性名")}))}function B(e){var t=["ele_selector"];D(e)&&d(e,(function(r,n){var i,a;D(r)?B(e[n]):R(r)&&(e[n]=(i=r,a=T(t,n)>-1?1024:ut.para.max_string_length,i.length>a?(u.log("字符串长度超过限制，已经做截取--"+i),i.slice(0,a)):i))}))}function G(){return"undefined"!=typeof navigator&&"function"==typeof navigator.sendBeacon}var Y,Q=(Y=(new Date).getTime(),function(e){return Math.ceil((Y=(9301*Y+49297)%233280)/233280*e)});function Z(){if("function"==typeof Uint32Array){var e="";if("undefined"!=typeof crypto?e=crypto:"undefined"!=typeof msCrypto&&(e=msCrypto),D(e)&&e.getRandomValues){var t=new Uint32Array(1);return e.getRandomValues(t)[0]/Math.pow(2,32)}}return Q(1e19)/1e19}function ee(e){var t=null;if(!e)return t;try{t=JSON.parse(e)}catch(e){}return t}function te(e){for(var t,r=[],n={},i=0;i<e.length;i++)(t=e[i])in n||(n[t]=!0,r.push(t));return r}var re={regChecks:{regName:/^((?!^distinct_id|^events|^\$|^_)[a-zA-Z_][a-zA-Z\d-_]{0,99})$/i},checkPropertiesKey:function(e){var t=this,r=!0;return d(e,(function(e,n){t.regChecks.regName.test(n)||(r=!1)})),r},check:function(e,t){return"string"==typeof this[e]?this[this[e]](t):this[e](t)},properties:function(e){return K(e),!e||(D(e)?(this.checkPropertiesKey(e)||u.log("自定义属性名需要是合法的变量名，不能以数字、下划线开头，且只包含：大小写字母、数字、下划线，不能是distinct_id、events"),!0):(u.log("properties可以没有，但有的话必须是对象"),!0))},propertiesMust:function(e){return K(e),void 0===e||!D(e)||V(e)?(u.log("properties必须是对象且有值"),!0):(this.checkPropertiesKey(e)||u.log("自定义属性名需要是合法的变量名，不能以数字、下划线开头，且只包含：大小写字母、数字、下划线，不能是distinct_id、events"),!0)},event:function(e){return R(e)&&this.regChecks.regName.test(e)||u.log("请检查参数格式，eventName 必须是字符串，自定义属性名需要是合法的变量名，不能以数字、下划线开头，且只包含：大小写字母、数字、下划线，不能是distinct_id、events"),!0},test_id:"str",group_id:"str",distinct_id:function(e){return!(!R(e)||!/^.{1,255}$/.test(e))||(u.log("distinct_id必须是不能为空，且小于255位的字符串"),!1)}};function ne(e){for(var t in e)if(!re.check(t,e[t]))return!1;return!0}function ie(t){var r=ut.para.current_domain;switch(e(r)){case"function":var n=r();return""===n||""===J(n)?"url解析失败":-1!==n.indexOf(".")?n:"url解析失败";case"string":return""===r||""===J(r)?"url解析失败":-1!==r.indexOf(".")?r:"url解析失败";default:var i=ae();return""===t||""===i?"url解析失败":i}}function ae(e){var t=(e=e||window.location.hostname).split(".");if(E(t)&&t.length>=2&&!/^(\d+\.)+\d+$/.test(e))for(var r="."+t.splice(t.length-1,1);t.length>0;)if(r="."+t.splice(t.length-1,1)+r,document.cookie="warlock_domain_test=true; path=/; domain="+r,-1!==document.cookie.indexOf("warlock_domain_test=true")){var n=new Date;return n.setTime(n.getTime()-1e3),document.cookie="warlock_domain_test=true; expires="+n.toUTCString()+"; path=/; domain="+r,r}return""}function oe(e){var t,r={},n=["hash","host","hostname","href","origin","password","pathname","port","protocol","search","username"];if("function"==typeof window.URL&&function(){try{return"http://modernizr.com/"===new URL("http://modernizr.com/").href}catch(e){return!1}}())(r=new URL(e)).searchParams||(r.searchParams=(t=N(r.search),{get:function(e){return t[e]}}));else{if(!1===/^https?:\/\/.+/.test(e))throw"Invalid URL";var i=document.createElement("a");i.href=e;for(var a=n.length-1;a>=0;a--){var o=n[a];r[o]=i[o]}r.hostname&&"string"==typeof r.pathname&&0!==r.pathname.indexOf("/")&&(r.pathname="/"+r.pathname),r.searchParams=function(){var e=N(r.search);return{get:function(t){return e[t]}}}()}return r}function se(e,t){return R(e=e||document.referrer)?(0!==(e=v(e=J(e))).indexOf("https://www.baidu.com/")||t||(e=e.split("?")[0]),R(e=e.slice(0,ut.para.max_referrer_string_length))?e:""):"取值异常_referrer异常_"+String(e)}function ce(e,t){t&&"string"==typeof t||(t="hostname解析异常");var r=null;try{r=oe(e).hostname}catch(e){u.log("getHostname传入的url参数不合法！")}return r||t}function ue(){function e(e,t){for(var r=0;r<e.length;r++)if(-1!==t.split("?")[0].indexOf(e[r]))return!0}var t=ut.para.source_type.search,r=ut.para.source_type.social,n=document.referrer||"";return pe.pageProp.url?e(t,n)?"自然搜索流量":e(r,n)?"社交网站流量":""===n?"直接流量":"引荐流量":"获取url异常"}function le(e,t){e=e||document.referrer;var r=ut.para.source_type.keyword;if(document&&R(e)){if(0===e.indexOf("http")){var n=function(e){var t=ce(e);if(!t||"hostname解析异常"===t)return"";var r={baidu:[/^.*\.baidu\.com$/],bing:[/^.*\.bing\.com$/],google:[/^www\.google\.com$/,/^www\.google\.com\.[a-z]{2}$/,/^www\.google\.[a-z]{2}$/],sm:[/^m\.sm\.cn$/],so:[/^.+\.so\.com$/],sogou:[/^.*\.sogou\.com$/],yahoo:[/^.*\.yahoo\.com$/]};for(var n in r)for(var i=r[n],a=0,o=i.length;a<o;a++)if(i[a].test(t))return n;return"未知搜索引擎"}(e),i=de(e);if(V(i))return"未取到值";var a=null;for(var o in r)if(n===o&&D(i))if(E(a=r[o]))for(var s=0;s<a.length;s++){var c=i[a[s]];if(c)return t?{active:c}:c}else if(i[a])return t?{active:i[a]}:i[a];return"未取到值"}return""===e?"未取到值_直接打开":"未取到值_非http的url"}return"取值异常_referrer异常_"+String(e)}function fe(e){return""===(e=e||document.referrer)||ae(ce(e))!==ae()}function de(e){var t={},r=e.split("?")[1]||"";return r&&(t=N("?"+r)),t}var pe={initPage:function(){var e=se(),t=_(),r=ie(t);this.pageProp={referrer:e,referrer_host:e?ce(e):"",url:t,url_host:ce(t,"url_host取值异常"),url_domain:r}},pageProp:{},properties:function(){var e=window.innerHeight||document.documentElement.clientHeight||document.body&&document.body.clientHeight||0,t=window.innerWidth||document.documentElement.clientWidth||document.body&&document.body.clientWidth||0;return{timezone_offset:(new Date).getTimezoneOffset(),screen_height:Number(screen.height)||0,screen_width:Number(screen.width)||0,viewport_height:e,viewport_width:t}},currentProps:{},data:{last_page_url:""},register:function(e){p(pe.currentProps,e)}};function he(e,t){if(R(t)&&"input"===t.toLowerCase())return r=e,n=ut.para.heatmap&&L(ut.para.heatmap.collect_input)&&ut.para.heatmap.collect_input(r),("button"===r.type||"submit"===r.type||n)&&r.value||"";var r,n,i="";return e.textContent?i=J(e.textContent):e.innerText&&(i=J(e.innerText)),i&&(i=i.replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)),i||""}function ge(e){var t={};if(!x(e))return t;var r=e.tagName.toLowerCase();t.ele_type=r,t.ele_name=e.getAttribute("name"),t.ele_id=e.getAttribute("id"),t.ele_class_name=R(e.className)?e.className:null,t.ele_target_url=e.getAttribute("href"),t.ele_content=he(e,r);for(var n,i={},a=e.attributes,o=0;o<a.length;o++){var s=a[o].nodeName;["id","class","data-warlock-click","name"].indexOf(s)<0&&(i[s]=a[o].nodeValue)}return t.ele_attributes=JSON.stringify(i),n={},d(t,(function(e,t){null!=e&&(n[t]=e)})),(t=n).page_url=_(),ut.para.page_title&&(t.page_title=document.title),t.viewport_width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth||0,t}function ve(e){return(e=J(e))&&("://"===e.slice(0,3)?e=location.protocol.slice(0,-1)+e:"//"===e.slice(0,2)?e=location.protocol+e:"http"!==e.slice(0,4)&&(e="")),e}var me,_e=(me=function(){for(var e=X(),t=0;e==X();)t++;return e.toString(16)+t.toString(16)},function(){var e=String(screen.height*screen.width);e=e&&/\d{5,}/.test(e)?e.toString(16):String(31242*Z()).replace(".","").slice(0,8);var t=me()+"-"+Z().toString(16).replace(".","")+"-"+function(){var e,t,r=navigator.userAgent,n=[],i=0;function a(e,t){var r,i=0;for(r=0;r<t.length;r++)i|=n[r]<<8*r;return e^i}for(e=0;e<r.length;e++)t=r.charCodeAt(e),n.unshift(255&t),n.length>=4&&(i=a(i,n),n=[]);return n.length>0&&(i=a(i,n)),i.toString(16)}()+"-"+e+"-"+me();return t||(String(Z())+String(Z())+String(Z())).slice(2,15)});function be(e){var t,r=location.href,n=window.history.pushState,i=window.history.replaceState;L(window.history.pushState)&&(window.history.pushState=function(){n.apply(window.history,arguments),e(r),r=location.href}),L(window.history.replaceState)&&(window.history.replaceState=function(){i.apply(window.history,arguments),e(r),r=location.href}),t=window.document.documentHashMode?"hashchange":n?"popstate":"hashchange",Ce(window,t,(function(){e(r),r=location.href}))}function ye(t,r,n){var i=null;if((t=t||{}).ele&&(i=t.ele),t.event&&(i=t.target?t.target:t.event.target),n=n||{},!i||"object"!==e(i))return!1;if(!i.href||/^javascript/.test(i.href)||i.target||i.download||i.onclick)return ut.track(r,n),!1;function a(e){e.stopPropagation(),e.preventDefault();var t=!1;function a(){t||(t=!0,location.href=i.href)}setTimeout(a,1e3),ut.track(r,n,a)}t.event&&a(t.event),t.ele&&Ce(t.ele,"click",(function(e){a(e)}))}function we(e){return new xe(e)}var ke=function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r};function Se(e,t){for(var r=0;e;)e.nodeName.toLowerCase()===t&&(r+=1),e=e.previousElementSibling;return r}function Oe(t){return t&&"object"===e(t)&&1===t.nodeType&&"object"===e(t.style)&&"object"===e(t.ownerDocument)}var Pe=["svg","path","g","image","text","line","rect","polygon","circle","ellipse"],je=["html","body"].concat(Pe),Te=function(e){var t=e.tagName.toLowerCase();return-1!==Pe.indexOf(t)?"*[name()='".concat(t,"']"):t};function Ne(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Oe(e))return null;for(var r=e,n=!1,i=-1!==Pe.indexOf(r.tagName.toLowerCase()),a=[];r&&r.nodeType===Node.ELEMENT_NODE;){var o=r.nodeName.toLowerCase(),s=Se(r,o),c="";!n&&r.hasAttribute("id")&&(c='[@id="'.concat(r.id,'"]'),n=!0);var u="";if(u=c?"":-1===je.indexOf(o)?"[".concat(s,"]"):1===s?"":"[".concat(s,"]"),a.push("".concat(Te(r)).concat(u).concat(c)),c&&!i&&!t){a.push("");break}r=r.parentNode}return"/".concat(a.reverse().join("/"))}var xe=function(){return i((function e(t){n(this,e),Object.defineProperty(this,"ele",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ele=t}),[{key:"addClass",value:function(e){return-1===(" "+this.ele.className+" ").indexOf(" "+e+" ")&&(this.ele.className=this.ele.className+(""===this.ele.className?"":" ")+e),this}},{key:"removeClass",value:function(e){var t=" "+this.ele.className+" ";return-1!==t.indexOf(" "+e+" ")&&(this.ele.className=t.replace(" "+e+" "," ").slice(1,-1)),this}},{key:"hasClass",value:function(e){return-1!==(" "+this.ele.className+" ").indexOf(" "+e+" ")}},{key:"attr",value:function(e,t){return"string"==typeof e&&C(t)?this.ele.getAttribute(e):("string"==typeof e&&(t=String(t),this.ele.setAttribute(e,t)),this)}},{key:"offset",value:function(){try{var e=this.ele.getBoundingClientRect(),t=this.ele.ownerDocument.documentElement;return{top:e.top+window.pageYOffset-t.clientTop,left:e.left+window.pageXOffset-t.clientLeft}}catch(e){return{top:0,left:0}}}},{key:"getSize",value:function(){if(!window.getComputedStyle)return{width:this.ele.offsetWidth,height:this.ele.offsetHeight};try{var e=this.ele.getBoundingClientRect();return{width:e.width,height:e.height}}catch(e){return{width:0,height:0}}}},{key:"getStyle",value:function(e){return this.ele.currentStyle?this.ele.currentStyle[e]:null===(t=this.ele.ownerDocument.defaultView)||void 0===t?void 0:t.getComputedStyle(this.ele,null).getPropertyValue(e);var t}},{key:"wrap",value:function(e){var t=document.createElement(e);return this.ele.parentNode.insertBefore(t,this.ele),t.appendChild(this.ele),we(t)}},{key:"getCssStyle",value:function(e){var t=this.ele.style.getPropertyValue(e);if(t)return t;var r=null;if("function"==typeof window.getMatchedCSSRules&&(r=window.getMatchedCSSRules(this.ele)),!r||!E(r))return null;for(var n=r.length-1;n>=0;n--){if(t=r[n].style.getPropertyValue(e))return t}}},{key:"sibling",value:function(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}},{key:"next",value:function(){return this.sibling(this.ele,"nextSibling")}},{key:"prev",value:function(){return this.sibling(this.ele,"previousSibling")}},{key:"siblings",value:function(){return ke((this.ele.parentNode||{}).firstChild,this.ele)}},{key:"children",value:function(){return ke(this.ele.firstChild)}},{key:"parent",value:function(){var e=this.ele.parentNode;return e=e&&11!==e.nodeType?e:null,we(e)}},{key:"getSameTypeSiblings",value:function(){var e=this.ele,t=e.parentNode,r=e.tagName.toLowerCase(),n=[];if(t)for(var i=0;i<t.children.length;i++){var a=t.children[i];1===a.nodeType&&a.tagName.toLowerCase()===r&&n.push(t.children[i])}return n}},{key:"getParents",value:function(){try{var e=this.ele;if(!x(e))return[];var t=[e];if(null===e||null===e.parentElement)return[];for(;null!==e.parentElement;)e=e.parentElement,t.push(e);return t}catch(e){return[]}}}])}();function Ce(e,t,r,n){function i(e){return e&&(e.preventDefault=i.preventDefault,e.stopPropagation=i.stopPropagation,e._getPath=i._getPath),e}i._getPath=function(){return this.path||this.composedPath&&this.composedPath()||we(this.target).getParents()},i.preventDefault=function(){this.returnValue=!1},i.stopPropagation=function(){this.cancelBubble=!0};(function(e,t,r){if(void 0===n&&"click"===t&&(n=!0),e&&e.addEventListener)e.addEventListener(t,(function(e){e._getPath=i._getPath,r.call(this,e)}),n);else{var a="on"+t,o=e[a];e[a]=function(e,t,r,n){var a=function(a){if(a=a||i(window.event)){a.target=a.srcElement||a.target;var o,s,c=!0;return"function"==typeof r&&(o=r(a)),s=t.call(e,a),"beforeunload"!==n?(!1!==o&&!1!==s||(c=!1),c):void 0}};return a}(e,r,o,t)}}).call(null,e,t,r)}function Ee(e){window.addEventListener("ajaxReadyStateChange",e)}function Le(e){e.log=function(){u.log(arguments)},e.warn=function(){u.warn(arguments)},e.error=function(){u.error(arguments)}}function De(e){function t(e){if(!e)return"";try{return JSON.parse(e)}catch(e){return{}}}e.timeout=e.timeout||2e4,e.credentials=void 0===e.credentials||e.credentials;var r=function(e){if(e)return void 0!==window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?new XMLHttpRequest:"undefined"!=typeof XDomainRequest?new XDomainRequest:null;if(void 0!==window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){u.log(e)}}}(e.cors);if(!r)return!1;e.type||(e.type=e.data?"POST":"GET");var n=(e=p({success:function(){},error:function(){}},e)).success,i=e.error,a=null;e.success=function(e){n(e),a&&(clearTimeout(a),a=null)},e.error=function(e){i(e),a&&(clearTimeout(a),a=null)},a=setTimeout((function(){!function(){try{D(r)&&r.abort&&r.abort()}catch(e){u.log(e)}a&&(clearTimeout(a),a=null,e.error&&e.error(),r.onreadystatechange=null)}()}),e.timeout),"undefined"!=typeof XDomainRequest&&r instanceof XDomainRequest&&(r.onload=function(){e.success&&e.success(t(r.responseText),r.status),r.onreadystatechange=null},r.onerror=function(){e.error&&e.error(t(r.responseText),r.status),r.onreadystatechange=null}),r.onreadystatechange=function(){try{4==r.readyState&&(r.status>=200&&r.status<300||304==r.status?e.success(t(r.responseText),r.status):e.error(t(r.responseText),r.status),r.onreadystatechange=null)}catch(e){r.onreadystatechange=null}},r.open(e.type,e.url,!0);try{e.credentials&&(r.withCredentials=!0),D(e.header)&&d(e.header,(function(e,t){r.setRequestHeader&&r.setRequestHeader(t,e)})),e.data&&(e.cors||r.setRequestHeader&&r.setRequestHeader("X-Requested-With","XMLHttpRequest"),"application/json"===e.contentType?r.setRequestHeader&&r.setRequestHeader("Content-type","application/json; charset=UTF-8"):r.setRequestHeader&&r.setRequestHeader("Content-type","application/x-www-form-urlencoded"))}catch(e){u.log(e)}r.send(e.data||null)}function Ie(e,t){if(!t||!t.length)return e;try{var r=new window.URL(e);return t.forEach((function(e){r.searchParams.delete(e)})),r.href}catch(t){return e}}var Re=Object.freeze({__proto__:null,DomElementInfo:xe,UUID:_e,_URL:oe,_decodeURI:v,_decodeURIComponent:O,_localStorage:k,_sessionStorage:S,addAjaxEvent:Ee,addEvent:Ce,addHashEvent:function(e){var t="pushState"in window.history?"popstate":"hashchange";Ce(window,t,e)},addSinglePageEvent:be,ajax:De,check:ne,cookie:w,coverExtend:h,createPlugin:function(e,t,r){return function(e,t,r){if(t&&(e.name=t),r&&e.init){var n=e.init;e.init=function(t,i){if(Le(e),t.readyState&&t.readyState.state>=3||!t.sdkEvents)return a();function a(){n.call(e,t,i)}t.sdkEvents.on(r,a)}}}(e,t,r),e.plugin_version="1.0.0",e},deleteUrlParamsByNames:Ie,each:d,extend:p,filter:g,filterReservedProperties:$,findIndex:Se,formatDate:H,getCookieTopLevelDomain:ae,getCurrentDomain:ie,getEleInfo:ge,getElementContent:he,getHostname:ce,getKeywordFromReferrer:le,getQueryParam:function(e,t){var r=oe(e),n=r.searchParams.get(t)||"";if(!n){var i=r.hash;if(i)n=de(i)[t]||""}return n},getQueryParamsFromUrl:de,getRandom:Z,getReferrer:se,getSourceFromReferrer:ue,getTagName:Te,getUA:m,getURL:_,getURLSearchParams:N,getXpath:Ne,hasAttribute:P,hasAttributes:j,ignoreTags:je,indexOf:T,isArray:E,isBoolean:M,isDOM:Oe,isDate:q,isElement:x,isEmptyObject:V,isFunction:L,isHttpUrl:function(e){return"string"==typeof e&&!1!==/^https?:\/\/.+/.test(e)},isJSONString:U,isNormalString:A,isNumber:I,isObject:D,isReferralTraffic:fe,isString:R,isSupportBeaconSend:G,isSupportCors:z,isUndefined:C,listenPageState:b,loadScript:y,now:X,optimizeServerUrl:ve,pageInfo:pe,ry:we,safeJSONParse:ee,searchConfigData:F,searchObjDate:W,searchObjString:B,strip_wl_properties:K,svgTags:Pe,throttle:function(e,t,r){var n,i,a,o=null,s=0;r||(r={});var c=function(){s=!1===r.leading?0:X(),o=null,a=e.apply(n,i),o||(n=i=null)};return function(){var u=X();s||!1!==r.leading||(s=u);var l=t-(u-s);return n=this,i=arguments,l<=0||l>t?(o&&(clearTimeout(o),o=null),s=u,a=e.apply(n,i),o||(n=i=null)):o||!1===r.trailing||(o=setTimeout(c,l)),a}},trackLink:ye,trim:J,unique:te,wrapLogFn:Le});function Ae(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Ue(e){return function(e){if(Array.isArray(e))return Ae(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ae(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ae(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Me=function(){return i((function e(t){n(this,e),Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"server_url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callback=t.callback,this.server_url=t.server_url,this.data=t.data}),[{key:"start",value:function(){var e=this,t=X();De({url:this.server_url,type:"POST",data:this.data,contentType:"application/json",credentials:ut.para.credentials,timeout:ut.para.datasend_timeout,cors:!0,success:function(r,n){ut.events.emit("sendSuccess",{status:String(n),resText:r,type:"ajax_single",timeout_config:ut.para.datasend_timeout,request_timeout:X()-t,data:e.data}),e.end()},error:function(r,n){ut.events.emit("sendFail",{status:String(n),resText:r,type:"ajax_single",timeout_config:ut.para.datasend_timeout,request_timeout:X()-t,data:e.data}),e.end()}})}},{key:"end",value:function(){this.callback&&this.callback()}}])}(),Ve=function(){return i((function e(t){n(this,e),Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"server_url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"img",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callback=t.callback,this.img=document.createElement("img"),this.img.width=1,this.img.height=1,ut.para.img_use_crossorigin&&(this.img.crossOrigin="anonymous"),this.data=t.data,this.server_url=function(e,t){var r=ee(t),n=[];d(r,(function(e,t){E(e)&&(e=JSON.stringify(e)),n.push("".concat(t,"=").concat(encodeURIComponent(e)))}));var i=n.join("&");return-1!==e.indexOf("?")?e+"&"+i:e+"?"+i}(t.server_url,t.data)}),[{key:"start",value:function(){var e=this;ut.para.ignore_oom&&(this.img.onload=function(){this.onload=null,this.onerror=null,this.onabort=null,e.end()},this.img.onerror=function(){this.onload=null,this.onerror=null,this.onabort=null,e.end()},this.img.onabort=function(){this.onload=null,this.onerror=null,this.onabort=null,e.end()}),this.img.src=this.server_url}},{key:"end",value:function(){this.callback&&this.callback();var e=this;setTimeout((function(){e.lastClear&&e.lastClear()}),ut.para.datasend_timeout-ut.para.callback_timeout)}},{key:"lastClear",value:function(){void 0!==m().ie?this.img.src="about:blank":this.img.src=""}}])}(),Fe=function(){return i((function e(t){n(this,e),Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"server_url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callback=t.callback,this.server_url=t.server_url,this.data=t.data}),[{key:"start",value:function(){var t=this;if("object"===("undefined"==typeof navigator?"undefined":e(navigator))&&"function"==typeof navigator.sendBeacon){var r;try{var n=this.data;ut.para.send_beacon_json&&(n=new Blob([this.data],{type:"application/json"})),r=navigator.sendBeacon(this.server_url,n)}catch(e){}r||this.sendDataFallback()}setTimeout((function(){t.end()}),40)}},{key:"end",value:function(){this.callback&&this.callback()}},{key:"sendDataFallback",value:function(){try{new Me({data:this.data,server_url:this.server_url}).start()}catch(e){u.log("sendBeacon failed")}}}])}(),Ke=function(){return i((function e(t,r){n(this,e),Object.defineProperty(this,"lockGetPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lockSetPrefix",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lockGetPrefix=t||"lock-get-prefix",this.lockSetPrefix=r||"lock-set-prefix"}),[{key:"get",value:function(e,t,r,n){if(!e)throw new Error("key is must");t=t||1e4,r=r||1e3,n=n||function(){};var i=this.lockGetPrefix+e,a=k.get(i),o=String(Z());if(a&&(a=ee(a)||{randomNum:0,expireTime:0}).expireTime>X())return n(null);k.set(i,JSON.stringify({randomNum:o,expireTime:X()+t})),setTimeout((function(){(a=ee(k.get(i))||{randomNum:0,expireTime:0})&&a.randomNum===o?(n(k.get(e)),k.remove(e),k.remove(i)):n(null)}),r)}},{key:"set",value:function(e,t,r,n,i){if(!e||!t)throw new Error("key and val is must");r=r||1e4,n=n||1e3,i=i||function(){};var a=this.lockSetPrefix+e,o=k.get(a),s=String(Z());if(o&&(o=ee(o)||{randomNum:0,expireTime:0}).expireTime>X())return i({status:"fail",reason:"This key is locked"});k.set(a,JSON.stringify({randomNum:s,expireTime:X()+r})),setTimeout((function(){(o=ee(k.get(a))||{randomNum:0,expireTime:0}).randomNum===s?k.set(e,t)&&i({status:"success"}):i({status:"fail",reason:"This key is locked"})}),n)}}])}(),Je="wlwebjssdk-",Xe="tab-wlwebjssdk-",ze=function(){return i((function e(){n(this,e),Object.defineProperty(this,"tabKey",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"serverUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendTimeStamp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hasTabStorage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sendTimeStamp=0,this.timer=null,this.serverUrl="",this.hasTabStorage=!1}),[{key:"batchInterval",value:function(){""===this.serverUrl&&this.getServerUrl(),this.hasTabStorage||(this.generateTabStorage(),this.hasTabStorage=!0);var e=this;e.timer=setTimeout((function(){e.updateExpireTime(),e.recycle(),e.send(),clearTimeout(e.timer),e.batchInterval()}),ut.para.batch_send.send_interval)}},{key:"getServerUrl",value:function(){if(!(R(ut.para.server_url)&&""!==ut.para.server_url||E(ut.para.server_url)&&ut.para.server_url.length))return u.log("当前 server_url 为空或不正确，只在控制台打印日志，network 中不会发数据，请配置正确的 server_url！");this.serverUrl=E(ut.para.server_url)?ut.para.server_url[0]:ut.para.server_url}},{key:"send",value:function(){if(!(this.sendTimeStamp&&X()-this.sendTimeStamp<ut.para.batch_send.datasend_timeout)){var e=k.get(this.tabKey);if(e){var t=te((e=ee(e)||this.generateTabStorageVal()).data);if(t.length){this.sendTimeStamp=X();for(var r=[],n=0;n<t.length;n++){var i=ut.store.readObjectVal(t[n]);i&&r.push(i)}var a=r[0];if(a){a._ts=X();for(var o=1;o<r.length;o++){var s=r[o];a.events.push(s.events[0])}this.request(JSON.stringify(a),e.data)}}}}}},{key:"request",value:function(e,t){var r=this,n=ut.para.server_url,i=X();De({url:n,type:"POST",data:e,contentType:"application/json",credentials:!0,timeout:ut.para.batch_send.datasend_timeout,cors:!0,success:function(n,a){ut.events.emit("sendSuccess",{status:String(a),resText:n,type:"ajax_batch",timeout_config:ut.para.batch_send.datasend_timeout,request_timeout:X()-i,data:e}),r.remove(t),r.sendTimeStamp=0},error:function(t,n){ut.events.emit("sendFail",{status:String(n),resText:t,type:"ajax_batch",timeout_config:ut.para.batch_send.datasend_timeout,request_timeout:X()-i,data:e}),r.sendTimeStamp=0}})}},{key:"updateExpireTime",value:function(){var e=k.get(this.tabKey);e&&((e=ee(e)||this.generateTabStorageVal()).expireTime=X()+2*ut.para.batch_send.send_interval,e.serverUrl=this.serverUrl,k.set(this.tabKey,JSON.stringify(e)))}},{key:"remove",value:function(e){var t=k.get(this.tabKey);if(t){for(var r=(ee(t)||this.generateTabStorageVal()).data,n=0;n<e.length;n++){var i=T(r,e[n]);i>-1&&r.splice(i,1),k.remove(e[n])}r=te(r),k.set(this.tabKey,JSON.stringify(this.generateTabStorageVal(r)))}}},{key:"add",value:function(e){var t=Je+String(Z()),r=k.get(this.tabKey);if(null===r?(this.tabKey=Xe+String(Z()),r=this.generateTabStorageVal()):r=ee(r)||this.generateTabStorageVal(),r.data.push(t),r.expireTime=X()+2*ut.para.batch_send.send_interval,k.set(this.tabKey,JSON.stringify(r)),ut.store.saveObjectVal(t,e),e.events&&e.events[0]){var n=e.events[0].event;"PageView"!==n&&"Login"!==n||this.sendImmediately()}}},{key:"generateTabStorage",value:function(){this.tabKey=Xe+String(Z()),k.set(this.tabKey,JSON.stringify(this.generateTabStorageVal()))}},{key:"generateTabStorageVal",value:function(e){return{data:e=e||[],expireTime:X()+2*ut.para.batch_send.send_interval,serverUrl:this.serverUrl}}},{key:"sendImmediately",value:function(){this.send()}},{key:"recycle",value:function(){for(var e,t,r,n=this,i={},a="wljssdk-lock-get-",o=function(){var o=localStorage.key(s),c=n;if(0===o.indexOf(Xe)){for(e=ee(k.get(o))||n.generateTabStorageVal(),t=0;t<e.data.length;t++)i[e.data[t]]=!0;o!==c.tabKey&&X()>e.expireTime&&n.serverUrl===e.serverUrl&&new Ke(a).get(o,1e4,1e3,(function(e){if(e){null===k.get(c.tabKey)&&c.generateTabStorage();var t=ee(e)||c.generateTabStorageVal(),r=ee(k.get(c.tabKey))||c.generateTabStorageVal();r.data=te(r.data.concat(t.data)),k.set(c.tabKey,JSON.stringify(r))}}))}else 0===o.indexOf(a)&&(r=ee(k.get(o))||{expireTime:0},X()-r.expireTime>1e4&&k.remove(o))},s=0;s<localStorage.length;s++)o();for(var c=0;c<localStorage.length;c++){var u=localStorage.key(c);0!==u.indexOf(Je)||i[u]||k.remove(u)}}}])}(),We=new ze,$e={getRealtimeInstance:function(e){return this.getSend(e)},getSend:function(e){switch(this.getSendType(e)){case"beacon":return new Fe(e);case"ajax":default:return new Me(e);case"image":return new Ve(e)}},getSendType:function(e){var t=["beacon","ajax","image"],r=t[0];return e.config&&T(t,e.config.send_type)>-1?r=e.config.send_type:ut.para.send_type&&(r=ut.para.send_type),"beacon"===r&&!1===G()&&(r="ajax"),"ajax"===r&&!1===z()&&(r="image"),r}},Be={getSendCall:function(e,t,r){if(ut.readyState.state<3)return u.log("初始化没有完成"),!1;var n=(e.events||[]).map((function(e){var t=He({},e);return[].concat(Ue(ut.para.url_format_fields||[]),["page_url","page_referrer","first_referrer"]).forEach((function(e){t[e]&&(t[e]=ut.deleteIllegalParams(t[e]))})),t})),i=He(He({},e),{},{events:n}),a={data:i,config:t,callback:r};return!("function"==typeof ut.para.server_filter&&!ut.para.server_filter(i))&&(ut.events.emit("send",i),ut.para.batch_send&&localStorage.length<200&&!1!==t.batch_send?(u.log(i,"batchSend"),We.add(a.data),!1):(this.prepareServerUrl(a),void u.log(i,"sendData")))},prepareServerUrl:function(e){this.sendCall(e,ut.para.server_url,e.callback)},sendCall:function(e,t,r){var n=e.data,i={server_url:t,data:JSON.stringify(n),callback:r,config:e.config};this.realtimeSend(i)},realtimeSend:function(e){$e.getRealtimeInstance(e).start()}};var Ge={checkIsAddSign:function(e){"track"===e.event_type&&(e.properties.is_first_day=this.getNewUser())},is_first_visit_time:!1,checkIsFirstTime:function(e){},getNewUser:function(){if(ut.para.use_cookie)return w.getNewUser();var e=w.getCookieName("new_user"),t=k.get(e);if(t){var r=ee(t);return!!r&&(!((new Date).getTime()>r.expireTime)||(k.remove(e),!1))}return!1},storeInitCheck:function(){if(ut.is_first_visitor){var e=new Date,t={h:23-e.getHours(),m:59-e.getMinutes(),s:59-e.getSeconds()};ut.para.use_cookie?w.set(w.getCookieName("new_user"),"1",3600*t.h+60*t.m+t.s+"s"):(e.setTime(e.getTime()+1e3*(3600*t.h+60*t.m+t.s)),k.set(w.getCookieName("new_user"),JSON.stringify({value:1,expireTime:e.getTime()}))),this.is_first_visit_time=!0}else this.getNewUser()||(this.checkIsAddSign=function(e){"track"===e.event_type&&(e.properties.is_first_day=!1)})},checkIsFirstLatest:function(){var e,t=pe.pageProp.url_domain,r={};""===t&&(t="url解析失败"),d(ut.para,(function(e,n){if(-1===n.indexOf("latest_"))return!1;if(n=n.slice(7),e){if("url解析失败"===t)r["latest_"+n]="url的domain解析失败";else if(fe(document.referrer))switch(n){case"traffic_source_type":r.latest_traffic_source_type=ue();break;case"referrer":r.latest_referrer=pe.pageProp.referrer;break;case"search_keyword":r.latest_search_keyword=le();break;case"landing_page":r.latest_landing_page=location.href}}else ut.store._state.props&&"latest_"+n in ut.store._state.props&&delete ut.store._state.props["latest_"+n]})),ne({properties:e=r})?Ye.setProps(e):u.log("register输入的参数有误")}},Ye={requests:[],_state:{distinct_id:"",first_id:"",props:{},identities:{}},getProps:function(){return this._state.props||{}},getOriginDistinctId:function(){return this._state.distinct_id},getOriginUnionId:function(e){var t={},r=(e=e||this._state)._first_id||e.first_id,n=e._distinct_id||e.distinct_id;return r&&n?(t.login_id=n,t.anonymous_id=r):t.anonymous_id=n,t},getDistinctId:function(){var e=this.getUnionId();return e.login_id||e.anonymous_id},getUnionId:function(e){return this.getOriginUnionId(e)},getFirstId:function(){return this._state.first_id},toState:function(t){var r=null;if(null!=t&&U(t))if(r=JSON.parse(t),this._state=p(r),r.distinct_id){if("object"===e(r.props)){for(var n in r.props)"string"==typeof r.props[n]&&(r.props[n]=r.props[n].slice(0,ut.para.max_referrer_string_length));this.save()}}else this.set("distinct_id",_e());else this.set("distinct_id",_e())},setOnce:function(e,t){e in this._state||this.set(e,t)},set:function(e,t){this._state=this._state||{};var r=this._state.distinct_id;this._state[e]=t,this.save(),"distinct_id"===e&&r&&c.emit("changeDistinctId",t)},change:function(e,t){this._state["_"+e]=t},setProps:function(e,t){var r={};for(var n in r=t?e:p(this._state.props||{},e))"string"==typeof r[n]&&(r[n]=r[n].slice(0,ut.para.max_referrer_string_length));this.set("props",r)},setPropsOnce:function(e){var t=this._state.props||{};h(t,e),this.set("props",t)},save:function(){var e=JSON.parse(JSON.stringify(this._state)),t=JSON.stringify(e);ut.para.use_cookie?w.set(this.getCookieName(),t,365,ut.para.cross_subdomain):k.set(this.getCookieName(),t)},getCookieName:function(){return"warlockjssdkcross"+ut.para.sdk_id},init:function(){var e=_e();this.initStorage();var t=null;null===(t=ut.para.use_cookie?w.get(this.getCookieName()):k.get(this.getCookieName()))?(ut.is_first_visitor=!0,this.set("distinct_id",e)):(U(t)&&JSON.parse(t).distinct_id||(ut.is_first_visitor=!0),this.toState(t)),Ge.storeInitCheck(),Ge.checkIsFirstLatest()},initStorage:function(){if(!ut.para.use_cookie){var e=k.get(this.getCookieName()),t=w.get(this.getCookieName());if(!e)if(t)if(k.set(this.getCookieName(),t),w.get(w.getCookieName("new_user"))){var r=new Date,n={h:23-r.getHours(),m:59-r.getMinutes(),s:59-r.getSeconds()};r.setTime(r.getTime()+1e3*(3600*n.h+60*n.m+n.s)),k.set(w.getCookieName("new_user"),JSON.stringify({value:1,expireTime:r.getTime()}))}t&&(w.remove(this.getCookieName()),w.remove(this.getCookieName(),!0),w.remove(w.getCookieName("new_user")),w.remove(w.getCookieName("new_user"),!0))}},saveObjectVal:function(e,t){R(t)||(t=JSON.stringify(t)),k.set(e,t)},readObjectVal:function(e){var t=k.get(e);return t?ee(t):null}};var Qe={buildData:function(e){var t,r={distinct_id:Ye.getDistinctId(),properties:{event_ts:(new Date).getTime(),event_no:(new Date).getTime()}};return D(e)&&D(e.properties)&&V(e.properties)&&e.properties.lib_detail&&(r._lib.lib_detail=e.properties.lib_detail,delete e.properties.lib_detail),D(e.properties)&&!V(e.properties)&&p(r.properties,e.properties),delete e.properties,p(r.properties,ut.store.getUnionId(),e),r.event_type=e.event_type,r.event=e.event,e.event_type&&"profile"===e.event_type.slice(0,7)||(r.properties=p({},pe.properties(),Ye.getProps(),pe.currentProps,r.properties),ut.para.latest_referrer&&!R(r.properties.latest_referrer)&&(r.properties.latest_referrer="取值异常"),ut.para.latest_search_keyword&&!R(r.properties.latest_search_keyword)&&(r.properties.latest_search_keyword="取值异常"),ut.para.latest_traffic_source_type&&!R(r.properties.latest_traffic_source_type)&&(r.properties.latest_traffic_source_type="取值异常"),ut.para.latest_landing_page&&!R(r.properties.latest_landing_page)&&(r.properties.latest_landing_page="取值异常")),r.properties.time&&q(r.properties.time)&&(r.time=1*r.properties.time,delete r.properties.time),D(t=r)&&d(t,(function(e,r){if(L(e))try{t[r]=e(),L(t[r])&&(u.log("您的属性- "+r+" 格式不满足要求，我们已经将其删除"),delete t[r])}catch(e){delete t[r],u.log("您的属性- "+r+" 抛出了异常，我们已经将其删除")}})),function(e){var t=e.properties;D(t)?(K(t),$(t),B(t)):"properties"in e&&(e.properties={}),W(e)}(r),Ge.checkIsAddSign(r),function(e){var t=!e.event_type||"profile"!==e.event_type.slice(0,7),r="取值异常";D(e.properties)&&(e.properties.first_referrer&&(e.properties.first_referrer_host=ce(e.properties.first_referrer,r)),t&&("referrer"in e.properties&&(e.properties.referrer_host=""===e.properties.referrer?"":ce(e.properties.referrer,r)),ut.para.latest_referrer&&ut.para.latest_referrer_host&&(e.properties.latest_referrer_host=""===e.properties.latest_referrer?"":ce(e.properties.latest_referrer,r))))}(r),function(e){var t=!e.event_type||"profile"!==e.event_type.slice(0,7);t&&ut.para.page_url&&void 0===e.properties.page_url&&(e.properties.page_url=_()),t&&ut.para.page_title&&void 0===e.properties.page_title&&(e.properties.page_title=document.title)}(r),r.properties.app_ver=ut.para.app_ver,r._reqid=_e(),r._topic=ut.para.token,r._v=ut._v,r._lib=ut._lib,r._lib_version=ut._lib_version,r.app_name=ut.para.app_name,delete r.event_type,delete r.event,this.filterProperties(r),r},filterProperties:function(e){L(ut.para.filter_properties)&&e.properties&&ut.para.filter_properties(e.properties,e)},sendData:function(e,t){var r=F(e.properties);(e._ts=X(),e.properties)?(e.events=[e.properties],delete e.properties):r=F(e.events[0]);ut.sendState.getSendCall(e,r,t)}},Ze={check:ne,send:function(e,t){var r=Qe.buildData(e);Qe.sendData(r,t)},sendMult:function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],a=Qe.buildData(i);r.push(a)}var o=r[0];if(o){o.events=[],o.properties&&(o.events.push(o.properties),delete o.properties);for(var s=1;s<r.length;s++){var c=r[s];o.events.push(c.properties)}Qe.sendData(o,t)}}};function et(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rt={isCollectTag:function(e){return!this.isIgnoreTag(e)&&("a"===e||"button"===e||"input"===e||"textarea"===e)},isIgnoreTag:function(e){if(ut.para.auto_track_ignore_elements){if(M(ut.para.auto_track_ignore_elements))return!0;if(E(ut.para.auto_track_ignore_elements)&&ut.para.auto_track_ignore_elements.indexOf(e)>-1)return!0}return!1},getAttributeNames:function(e){var t=[];if(e.getAttributeNames)return e.getAttributeNames();for(var r=0;r<e.attributes.length;r++)t.push(e.attributes[r].name);return t},getDomIndex:function(e){if(!e.parentNode)return-1;for(var t=0,r=e.tagName,n=e.parentNode.children,i=0;i<n.length;i++)if(n[i].tagName===r){if(e===n[i])return t;t++}return-1},selector:function(e){var t=e.parentNode&&9==e.parentNode.nodeType?-1:this.getDomIndex(e);return e.getAttribute&&e.getAttribute("id")?"#"+e.getAttribute("id"):e.tagName.toLowerCase()+(~t?":nth-of-type("+(t+1)+")":"")},getDomSelector:function(e,t){var r;if(!e||!e.parentNode||!e.parentNode.children)return!1;t=t&&t.join?t:[];var n=e.nodeName.toLowerCase();return e&&"body"!==n&&1==e.nodeType?(t.unshift(this.selector(e)),e.getAttribute&&e.getAttribute("id")&&"not_use_id"!==(null===(r=ut.para.heatmap)||void 0===r?void 0:r.element_selector)?t.join(" > "):this.getDomSelector(e.parentNode,t)):(t.unshift("body"),t.join(" > "))},start:function(e,t,r,n,i){var a=D(n)?n:{},o=L(i)?i:L(n)?n:void 0;if(ut.para.auto_track_filter&&L(ut.para.auto_track_filter)&&!ut.para.auto_track_filter(t))return!1;var s=ge(t);if(ut.para.element_selector){var c=this.getDomSelector(t);s.ele_selector=c||""}for(var u="custom-prop-",l=this.getAttributeNames(t),f=0;f<l.length;f++)l[f].startsWith(u)&&(s[l[f].substr(12)]=t.getAttribute(l[f]));if(null!==e&&(s.page_x=Math.round(e.pageX),s.page_y=Math.round(e.pageY)),L(ut.para.auto_track_property_extend)){var d=ut.para.auto_track_property_extend(t);D(d)&&(s=p(s,d))}s=p(s,a),"a"===r&&ut.para.heatmap&&!0===ut.para.heatmap.isTrackLink?ye({event:e,target:t},"WebClick",s):a.track_circle_type?ut.track(a.event,s,o):ut.track("WebClick",s,o)},hasElement:function(t){var r=t._getPath();if(E(r)&&r.length>0)for(var n=0;n<r.length;n++)if("object"===e(r[n])&&1===r[n].nodeType&&(r[n].tagName&&this.isCollectTag(r[n].tagName.toLowerCase())||j(r[n],ut.para.auto_track_attr)))return r[n];return!1},initAutoTrack:function(){ut.listenSinglePage(),this.initHeatmap(),this.initCircleTrack(),ut.listenAjaxEvent()},initHeatmap:function(){var t=this;ut.para.auto_track_web_click&&Ce(document,"click",(function(r){var n=r||window.event;if(!n)return!1;var i=n.target||n.srcElement;if("object"!==e(i))return!1;if("string"!=typeof i.tagName)return!1;var a=i.tagName.toLowerCase();if("body"===a.toLowerCase()||"html"===a.toLowerCase())return!1;if(!i||!i.parentNode||!i.parentNode.children)return!1;if(A(i.className)&&ut.para.auto_track_elements_class&&E(ut.para.auto_track_elements_class))for(var o=i.className.split(" "),s=0;s<o.length;s++)if(ut.para.auto_track_elements_class.indexOf(o[s])>=0)return void t.start(n,i,a);if(ut.para.auto_track_elements_id&&E(ut.para.auto_track_elements_id)&&ut.para.auto_track_elements_id.indexOf(i.getAttribute("id"))>=0)t.start(n,i,a);else if(ut.para.auto_track_elements&&E(ut.para.auto_track_elements)&&ut.para.auto_track_elements.indexOf(a)>=0&&!t.isIgnoreTag(a))t.start(n,i,a);else if(t.isCollectTag(a)||j(i,ut.para.auto_track_attr))t.start(n,i,a);else{var c=t.hasElement(r);c&&t.start(n,c,c.tagName.toLowerCase())}}))},circleStore:{clickEvents:[],pageViewEvents:[]},getCircleTrackList:function(e){this.circleStore={clickEvents:[],pageViewEvents:[]};var t=JSON.stringify({token:ut.para.token,pageUrl:ut.deleteIllegalParams(location.href)}),r=this,n="https://warlock.zhipin.com/wapi/warlock/cross/event/visible/client/fetch";"dev"===ut.para.env&&(n="https://boss-m-qa.weizhipin.com/wapi/warlock/cross/event/visible/client/fetch"),De({url:n,type:"POST",data:t,contentType:"application/json",credentials:ut.para.credentials,cors:!0,success:function(t){0===t.meta.code&&(r.circleStore=t.data),e&&e(t)}})},initCircleTrack:function(){var t=this,r=this;if(ut.para.allow_circle_track)try{this.getCircleTrackList((function(){t.handleCirclePageView(),Ce(document,"click",(function(t){var n=t||window.event;if(!n)return!1;var i=n.target||n.srcElement;if("object"!==e(i))return!1;if("string"!=typeof i.tagName)return!1;var a=i.tagName.toLowerCase();if("body"===a.toLowerCase()||"html"===a.toLowerCase())return!1;if(!i||!i.parentNode||!i.parentNode.children)return!1;var o=r.hasCircleElement(t);if(o){var s=o.el,c=o.circleEvent;r.start(n,s,s.tagName.toLowerCase(),{event:c.eventName,track_circle_type:"WebClick"})}}))}))}catch(e){console.error("处理页面圈选PageView事件出错",e)}},hasCircleElement:function(t){var r=t._getPath();if(E(r)&&r.length>0)for(var n=0;n<r.length;n++){if(n>10)return!1;if("object"===e(r[n])&&1===r[n].nodeType&&r[n].tagName){var i=this.isCircleElement(r[n]);if(i)return{el:r[n],circleEvent:i}}}return!1},isCircleElement:function(e){var t=Ne(e);return this.circleStore.clickEvents.find((function(e){return e.xpath===t}))},handleCirclePageView:function(){var e=this;try{this.sendCirclePageView(),ut.events.on("single-page-switch",(function(t){t!==location.href&&e.getCircleTrackList((function(){e.sendCirclePageView({page_referrer:_(t)})}))}))}catch(e){console.error("处理页面圈选PageView事件出错",e)}},sendCirclePageView:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.circleStore.pageViewEvents,r=[];t.forEach((function(t){r.push({name:t.eventName,data:tt({page_referrer:pe.data.last_page_url||pe.pageProp.referrer,page_url:location.href,page_title:document.title,track_circle_type:"PageView"},e)})})),r.length>0&&(r[0].data.$option={batch_send:!1}),ut.trackMult(r)}},nt={autoTrackIsUsed:!1,isReady:function(e){e()},trackWebClick:function(t,r,n){"object"===e(t)&&t.tagName&&rt.start(null,t,t.tagName.toLowerCase(),r,n)},trackPageView:function(e,t){var r=this.autoTrackIsUsed?pe.pageProp.url:pe.pageProp.referrer;function n(e,t){ut.track("PageView",p({page_referrer:r,page_url:location.href,page_title:document.title},e),t),r=location.href}e=D(e)?e:{},ut.is_first_visitor&&(ut.setOnceProfile({first_visit_time:new Date,first_referrer:se(),first_browser_language:navigator.language||"取值异常",first_browser_charset:"string"==typeof document.charset?document.charset.toUpperCase():"取值异常",first_traffic_source_type:ue(),first_search_keyword:le()}),ut.is_first_visitor=!1),n(e,t),this.trackPageView=n},autoTrackPageView:function(e,t){e=D(e)?e:{},ut.is_first_visitor&&(ut.setOnceProfile({first_visit_time:new Date,first_referrer:se(),first_browser_language:navigator.language||"取值异常",first_browser_charset:"string"==typeof document.charset?document.charset.toUpperCase():"取值异常",first_traffic_source_type:ue(),first_search_keyword:le()}),ut.is_first_visitor=!1),ut.para.need_first_auto_page_view&&ut.track("PageView",p({page_referrer:pe.data.last_page_url||pe.pageProp.referrer,page_url:location.href,page_title:document.title},e),t),this.autoTrackIsUsed=!0,pe.data.last_page_url=location.href}},it=function(){return i((function e(){n(this,e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PageLeave"}),Object.defineProperty(this,"wl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"page_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"page_show_status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"current_page_url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"option",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"max_duration",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.wl=null,this.page_id=null,this.start_time=+new Date,this.page_show_status=!0,this.timer=null,this.url=location.href,this.current_page_url=document.referrer,this.option={},this.max_duration=432e3}),[{key:"init",value:function(e,t){e?(this.wl=e,t&&(this.option=t),this.page_id=Number(String(Z()).slice(2,5)+String(Z()).slice(2,4)+String((new Date).getTime()).slice(-4)),this.addEventListener(),!0===document.hidden&&(this.page_show_status=!1),this.log("PageLeave初始化完毕")):this.log("请传入warlock实例")}},{key:"addEventListener",value:function(){this.addPageStartListener(),this.addPageSwitchListener(),this.addSinglePageListener(),this.addPageEndListener()}},{key:"pageStartHandler",value:function(){this.start_time=X(),"visible"===document.visibilityState?this.page_show_status=!0:this.page_show_status=!1,this.url=location.href}},{key:"pageEndHandler",value:function(){if(this.page_show_status){var e=this.getPageLeaveProperties();this.page_show_status=!1,this.wl.track("WebPageLeave",e)}}},{key:"getPageLeaveProperties",value:function(){var e=(+new Date-this.start_time)/1e3;(isNaN(e)||e<0||e>this.max_duration)&&(e=0),e=Number(e.toFixed(3));var t=se(this.current_page_url),r=document.documentElement&&document.documentElement.scrollTop||window.pageYOffset||document.body&&document.body.scrollTop||0;r=Math.round(r)||0;var n={page_title:document.title,page_url:location.href,page_referrer:t,viewport_position:r};return 0!==e&&(n.event_duration=e),n=p(n,this.option.custom_props)}},{key:"addPageStartListener",value:function(){var e=this;"onpageshow"in window&&Ce(window,"pageshow",(function(){e.pageStartHandler()}))}},{key:"addPageEndListener",value:function(){var e=this;"onpagehide"in window?Ce(window,"pagehide",(function(){e.pageEndHandler()})):Ce(window,"unload",(function(){e.pageEndHandler()}))}},{key:"addPageSwitchListener",value:function(){var e=this;b({visible:function(){e.pageStartHandler()},hidden:function(){e.url=location.href,e.pageEndHandler()}})}},{key:"addSinglePageListener",value:function(){var e=this;this.wl.events.on("single-page-switch",(function(t){t!==location.href&&(e.url=t,e.pageEndHandler(),e.current_page_url=e.url,e.pageStartHandler())}))}},{key:"log",value:function(e){u.log(e)}}])}();function at(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?at(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}for(var st={latest_traffic_source_type:!1,latest_search_keyword:!1,latest_referrer:!1,latest_referrer_host:!1,latest_landing_page:!1,page_url:!0,page_title:!0,element_selector:!0,ajax_response:!1,_v:"1.0.0",token:"",app_ver:"",app_name:"",server_url:"https://logapi.zhipin.com/dap/api/json",max_referrer_string_length:200,max_string_length:500,cross_subdomain:!1,show_log:!1,sdk_id:"",auto_track_page_view:!1,auto_track_web_click:!1,auto_track_ajax:!1,track_ka:!1,batch_send:!1,source_type:{},callback_timeout:200,datasend_timeout:8e3,ignore_oom:!0,credentials:!0,env:"prod",url_format_fields:[],illegal_params_names:[],need_first_auto_page_view:!0},ct=function(){return i((function e(){n(this,e),Object.defineProperty(this,"_",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"_t",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"is_first_visitor",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"_v",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_lib",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_lib_version",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"modules",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"readyState",{enumerable:!0,configurable:!0,writable:!0,value:{state:0,historyState:[],stateType:{1:"1-init未开始",2:"2-init开始",3:"3-store完成",4:"4-sdk初始化完成"},getState:function(){return this.historyState.join("\n")},setState:function(e){String(e)in this.stateType&&(this.state=e),this.historyState.push(this.stateType[e])}}}),Object.defineProperty(this,"para",{enumerable:!0,configurable:!0,writable:!0,value:ot({},st)}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:Ye}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:new s}),Object.defineProperty(this,"sdkEvents",{enumerable:!0,configurable:!0,writable:!0,value:new s}),Object.defineProperty(this,"sendState",{enumerable:!0,configurable:!0,writable:!0,value:Be}),Object.defineProperty(this,"logger",{enumerable:!0,configurable:!0,writable:!0,value:u}),this._=p({},Re),u.log("初始化完成aaa")}),[{key:"init",value:function(e){return this.sdkEvents.emit("beforeInit"),!(this.readyState&&this.readyState.state&&this.readyState.state>=2)&&(e&&e.token&&e.app_name?(this.setInitVar(),this.readyState.setState(2),this.initPara(e),this.sdkEvents.emit("initPara"),this.sdkEvents.emit("init"),this.initSystemEvent(),this.detectMode(),this.sdkEvents.emit("afterInit"),void this.sdkEvents.emit("ready")):(console.error("WARLOCK SDK INIT FAILED，[token, app_name] ONE OR MORE DO NOT EXIST"),!1))}},{key:"setInitVar",value:function(){this._t=this._t||X(),this.is_first_visitor=!1,this._v="1.0.0",this._lib="js";try{this._lib_version="2.2.8"}catch(e){this._lib_version="1.0.0"}}},{key:"initPara",value:function(t){this.para=p({},st,t);var r={datasend_timeout:6e3,send_interval:2e3,one_send_max_length:20};!1!==this.para.batch_send&&k.isSupport()&&z()&&"object"===("undefined"==typeof localStorage?"undefined":e(localStorage))?!0===this.para.batch_send?this.para.batch_send=p({},r):"object"===e(this.para.batch_send)&&(this.para.batch_send=p({},r,this.para.batch_send)):this.para.batch_send=!1,this.initParaSourceType(),this.para.heatmap&&!D(this.para.heatmap)&&(this.para.heatmap={});var n=E(this.para.auto_track_attr)?g(this.para.auto_track_attr,(function(e){return e&&"string"==typeof e})):[];n.push("data-warlock-click"),this.para.auto_track_attr=n,this.para.server_url=ve(this.para.server_url),!0===this.para.noCache?this.para.noCache="?"+X():this.para.noCache="",this.para.callback_timeout>this.para.datasend_timeout&&(this.para.datasend_timeout=this.para.callback_timeout)}},{key:"initParaSourceType",value:function(){var t=["www.baidu.","m.baidu.","m.sm.cn","so.com","sogou.com","youdao.com","google.","yahoo.com/","bing.com/","ask.com/"],r=["weibo.com","renren.com","kaixin001.com","douban.com","qzone.qq.com","zhihu.com","tieba.baidu.com","weixin.qq.com"],n={baidu:["wd","word","kw","keyword"],google:"q",bing:"q",yahoo:"p",sogou:["query","keyword"],so:"q",sm:"q"};"object"===e(this.para.source_type)&&(this.para.source_type.search=E(this.para.source_type.search)?this.para.source_type.search.concat(t):t,this.para.source_type.social=E(this.para.source_type.social)?this.para.source_type.social.concat(r):r,this.para.source_type.keyword=D(this.para.source_type.keyword)?p(n,this.para.source_type.keyword):n)}},{key:"detectMode",value:function(){this.trackMode()}},{key:"trackMode",value:function(){this.readyState.setState(3),pe.initPage(),ut.para.batch_send&&We.batchInterval(),ut.store.init(),ut.readyState.setState(4),rt.initAutoTrack()}},{key:"initSystemEvent",value:function(){var e=this;be((function(t){e.events.emit("single-page-switch",t)})),this.addKeyboardLinstener()}},{key:"listenSinglePage",value:function(e){this.para.auto_track_page_view&&this.events.on("single-page-switch",(function(t){var r=function(r){if(r=r||{},t!==location.href){pe.pageProp.referrer=_(t);var n=p({page_url:_(),page_referrer:_(t)},r);L(e)?e(n):ut.quick&&ut.quick("autoTrackPageView",n)}};if("boolean"==typeof ut.para.auto_track_page_view)r();else if("function"==typeof ut.para.auto_track_page_view){var n=ut.para.auto_track_page_view();D(n)?r(n):!0===n&&r()}}))}},{key:"listenAjaxEvent",value:function(){this.para.auto_track_ajax&&Ee((function(e){4===e.detail.readyState&&200===e.detail.status&&-1===e.detail.responseURL.indexOf("/dap/api/json")&&ut.track("Ajax",p({request_url:e.detail.responseURL,request_duration:(new Date).getTime()-e.detail.start_time}))}))}},{key:"addKeyboardLinstener",value:function(){document.addEventListener("keydown",(function(e){e.ctrlKey&&(e.altKey||e.metaKey)&&e.shiftKey&&"KeyB"===e.code&&(console.log("Control + Alt/Option + Shift + B 被按下"),ut.loadDetectDom())})),"1"===k.get("wk_sdk_detect_dom_flag")&&ut.loadDetectDom(),ut.checkAndRemoveURLParam()}},{key:"checkAndRemoveURLParam",value:function(){var e="warlock_sdk_active";if(N(window.location.search)[e]){var t=new URLSearchParams(window.location.search);t.delete(e);var r="".concat(window.location.pathname).concat(t.size?"?":"").concat(t.toString()).concat(window.location.hash);setTimeout((function(){history.replaceState(null,"",r)}),0),ut.loadDetectDom()}}},{key:"loadDetectDom",value:function(){ut.loadingScript||(console.log("激活小蜜蜂插件"),window.warlock_sdk_detect_dom?window.warlock_sdk_detect_dom():(ut.loadingScript=!0,y(k.get("wk_sdk_dom_url")||"https://unpkg.weizhipin.com/@datastar/warlock-detect-dom@latest/dist/index.js",(function(){ut.loadingScript=!1}))))}},{key:"setOnceProfile",value:function(e,t){Ze.check({propertiesMust:e})&&Ze.send({event_type:"profile_set_once",event:"PageView",properties:e},t)}},{key:"extendTrackProps",value:function(e){Ze.check({properties:e})?p(pe.currentProps,e):u.log("register输入的参数有误")}},{key:"register",value:function(e){Ze.check({properties:e})?Ye.setProps(e):u.log("register输入的参数有误")}},{key:"registerOnce",value:function(e){Ze.check({properties:e})?Ye.setPropsOnce(e):u.log("registerOnce输入的参数有误")}},{key:"anonymousId",value:function(e){"number"==typeof e&&(e=String(e));var t=Ye.getFirstId();if(void 0===e){var r=_e();t?Ye.set("first_id",r):Ye.set("distinct_id",r)}else Ze.check({distinct_id:e})?t?Ye.set("first_id",e):Ye.set("distinct_id",e):u.log("anonymousId的参数必须是字符串")}},{key:"login",value:function(e,t){if("number"==typeof e&&(e=String(e)),Ze.check({distinct_id:e})){var r=Ye.getFirstId(),n=Ye.getDistinctId();e!==n?(r||Ye.set("first_id",n),Ze.check({distinct_id:e,event:"Login",properties:{}})&&(Ye.set("distinct_id",e),Ze.send({event_type:"track_login",event:"Login",properties:{}},t))):t&&t()}else u.log("login的参数必须是字符串"),t&&t()}},{key:"logout",value:function(e){var t=Ye.getFirstId();if(t)if(Ye.set("first_id",""),!0===e){var r=_e();Ye.set("distinct_id",r)}else Ye.set("distinct_id",t);else u.log("没有first_id，logout失败")}},{key:"track",value:function(e,t,r){Ze.check({event:e,properties:t})&&Ze.send({event_type:"track",event:e,properties:t},r)}},{key:"trackMult",value:function(e,t){if(e.length>0){for(var r=[],n=0;n<e.length;n++){var i=e[n],a=i.name,o=i.data;Ze.check({event:a,properties:o})&&r.push({event_type:"track",event:a,properties:o})}Ze.sendMult(r,t)}}},{key:"quick",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t[0],i=t.slice(1);if("string"==typeof n&&nt[n])return nt[n].apply(nt,i);"function"==typeof n?n.apply(ut,i):u.log("quick方法中没有这个功能"+t[0])}},{key:"use",value:function(e,t){if(R(e)||D(e)){var r;if(D(e)){var n=ut.modules&&ut.modules[e.name];n&&n!==e&&u.log(e.name+" is conflict with builtin plugin, and sdk uses builtin plugin."),r=n||e}if(R(e)&&D(ut.modules)&&D(ut.modules[e])&&(r=ut.modules[e]),r&&L(r.init))return r.name||u.log("warning: invalid plugin, name required."),r.plugin_is_init||(!r.plugin_is_init&&r.init(ut,t),r.plugin_is_init=!0,ut.modules=ut.modules||{},ut.modules[r.name]=r),r;u.log("plugin is not found or plugin.init must be a function")}else u.log("must be string or object.")}},{key:"deleteIllegalParams",value:function(e,t){return e?(t||(t=this.para.illegal_params_names||[]),(t=t||[]).includes("t_uc")||t.push("t_uc"),t.some((function(t){return e.includes(t)}))?Ie(e,t):e):e}}])}(),ut=new ct,lt=[new it],ft=0;ft<lt.length;ft++){var dt=lt[ft];R(dt.name)&&(ut.modules[dt.name]=dt)}return"undefined"!=typeof window&&(window.Warlock=ut),ut}));